#!/usr/bin/env bash

# Generate RSA key pair with the specified requirements
ssh-keygen -t rsa -b 4096 -f school -N betty -C "Generated by script"

# Check if the private key file exists and is a valid OpenSSH key
if [ -f school ]; then
    if ssh-keygen -y -f school > /dev/null 2>&1; then
        echo "Private key file 'school' exists and is a valid OpenSSH private key."
    else
        echo "Error: 'school' is not a valid OpenSSH private key."
        exit 1
    fi
else
    echo "Error: Private key file 'school' does not exist."
    exit 1
fi

# Check if the public key file exists
if [ -f school.pub ]; then
    echo "Public key file 'school.pub' exists."
else
    echo "Error: Public key file 'school.pub' does not exist."
    exit 1
fi

# Confirm key generation and check bit length
if [ "$(ssh-keygen -y -f school 2>&1 | grep -o '4096 bits')" ]; then
    echo "RSA key is 4096 bits."
else
    echo "Error: RSA key is not 4096 bits."
    exit 1
fi

# Confirm key generation
echo "Key pair successfully generated."
ls -l school school.pub
